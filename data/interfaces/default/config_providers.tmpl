#import sickbeard
#set global $title="Config - Providers"
#set global $header="NZB Provider Configuration"

#set global $sbPath="../.."

<!--#set global $topmenu="config"#-->
#import os.path
#include $os.path.join($sickbeard.PROG_DIR, "data/interfaces/default/inc_top.tmpl")

<style type="text/css">
#provider_order_list { list-style-type: none; margin: 0; padding: 0; width: 250px; }
#provider_order_list li { margin: 0 5px 5px 5px; padding: 5px; font-size: 1.2em; height: 1.5em; }
html>body #provider_order_list li { height: 1.5em; line-height: 1.2em; }
.ui-state-highlight { height: 1.5em; line-height: 1.2em; }

.providerDiv { display: none; }
</style>
<script type="text/javascript">
\$(document).ready(function(){

  $.fn.showHideProviders = function() {
    \$('.providerDiv').each(function(){
      var providerName = \$(this).attr('id');
      var selectedProvider = \$('#editAProvider :selected').val();
      
      if (selectedProvider == providerName)
        \$(this).show();
      else
        \$(this).hide();
      
    });
  } 

  $.fn.showHideNewznabProviders = function() {
    \$('.newznabProviderDiv').each(function(){
      var providerName = \$(this).attr('id');
      var selectedProvider = \$('#editANewznabProvider :selected').val();
      
      if (selectedProvider == providerName)
        \$(this).show();
      else
        \$(this).hide();
      
    });
  } 

  \$('#editAProvider').change(function(){
    \$(this).showHideProviders();
  });

  \$('#editANewznabProvider').change(function(){
    \$(this).showHideNewznabProviders();
  });

  \$('.newznab_update').click(function(){

    var which_id = \$(this).parent().attr('id');
    var totalString = new Array();
    
    \$('.newznabProviderDiv').each(function(){
      
      var provider_id = \$(this).attr('id');

      if (provider_id == 'addNewznab' && which_id != 'addNewznab')
        return;
        
      var provider_name = \$('#'+provider_id+'_name').val();
      var provider_url = \$('#'+provider_id+'_url').val();
      var provider_username = \$('#'+provider_id+'_username').val();
      var provider_hash = \$('#'+provider_id+'_hash').val();

      if (provider_name == '' || provider_url == '') {
        alert('You must fill out at least name & url to add a provider.');
        return;
      }

      var newznabString = provider_name + '|' + provider_url + '|' + provider_username + '|' + provider_hash + '|1';
      
      totalString.push(newznabString);
    });
    
    \$('#newznab_providers').val(totalString.join('!!!'));
    
    alert(\$('#newznab_providers').val());
  });

  \$(this).showHideProviders();
  \$(this).showHideNewznabProviders();
  
});

\$(function() {
    \$("#provider_order_list").sortable({
        placeholder: 'ui-state-highlight',
        update: function (event, ui) {
              \$("#provider_order").val(\$("#provider_order_list").sortable('toArray').join(" "));
        }
    });
    \$("#provider_order_list").disableSelection();
});
</script>

<form action="saveProviders" method="POST">

<div class="EntryBlock">
<fieldset class="EntryFieldSet">

<legend>Provider Priorities</legend>

Drag the providers into the order<br />
you want them to be searched<br />
<br />
<ul id="provider_order_list">
#for $curProvider in $sickbeard.providers.sortedProviderList():
    #if $curProvider.getID() == 'tvbinz' and not $sickbeard.SHOW_TVBINZ
        #continue
    #end if
    #set $curName = $curProvider.getID()
    #if $curProvider in $sickbeard.newznabProviderList:
      #set $imgName = 'newznab.gif'
    #else:
      #set $imgName = $curName + '.gif'
    #end if
  <li class="ui-state-default" id="$curName">
    <input type="checkbox" name="$curName" id="enable_$curName" class="enabler" #if $curProvider.isEnabled() then "CHECKED" else ""#>
    <a href="$curProvider.url" class="imgLink" target="_new"><img src="$sbRoot/images/providers/$imgName" alt="$curProvider.name" width="16" height="16"></a>
    $curProvider.name
  </li>
#end for
</ul>
<br />
<input type="hidden" name="provider_order" id="provider_order" value="<%=" ".join(sickbeard.PROVIDER_ORDER)%>">

</fieldset>
</div>

<div class="EntryBlock">
<fieldset class="EntryFieldSet">

<legend>Providers</legend>

<b>Edit: </b> <select id="editAProvider">
#if $sickbeard.SHOW_TVBINZ then "<option value=\"tvbinz\">TVBinz" else ""#
<option value="nzbs">NZBs.org
<option value="nzbmatrix">NZBMatrix
<option value="nzbsrus">NZBs'R'US
</select>
<br />
<br />

#if $sickbeard.SHOW_TVBINZ:
<div class="providerDiv" id="tvbinz">

<a href="http://www.tvbinz.net" class="imgLink" target="_new"><img src="$sbRoot/images/providers/tvbinz.gif" alt="TVBinz" width="16" height="16"></a><br />
<br />

<strong>Cookie UID:</strong><br />
TVBinz cookie UID<br />
<input type="text" name="tvbinz_uid" value="$sickbeard.TVBINZ_UID" size="6"><br />
<br />

<strong>SAB UID:</strong><br />
SAB UID (only required if sending NZBs directly to SAB)<br />
<input type="text" name="tvbinz_sabuid" value="$sickbeard.TVBINZ_SABUID" size="6"><br />
<br />

<strong>Hash:</strong><br />
TVBinz hash string<br />
<input type="text" name="tvbinz_hash" value="$sickbeard.TVBINZ_HASH" size="35"><br />
<br />

<strong>Auth:</strong><br />
TVBinz auth string<br />
<input type="text" name="tvbinz_auth" value="$sickbeard.TVBINZ_AUTH" size="35"><br />
<br />

</div>
#end if

<div class="providerDiv" id="nzbs">

<a href="http://www.nzbs.org" class="imgLink" target="_new"><img src="$sbRoot/images/providers/nzbs.gif" alt="NZBs.org" width="16" height="16"></a><br />
<br />

<strong>UID:</strong><br />
NZBs.org UID<br />
<input type="text" name="nzbs_uid" value="$sickbeard.NZBS_UID" size="6"><br />
<br />

<strong>Hash:</strong><br />
NZBs.org hash<br />
<input type="text" name="nzbs_hash" value="$sickbeard.NZBS_HASH" size="35"><br />
<br />

</div>


<div class="providerDiv" id="nzbmatrix">

<a href="http://www.nzbmatrix.com" class="imgLink" target="_new"><img src="$sbRoot/images/providers/nzbmatrix.gif" alt="NZBMatrix" width="16" height="16"></a><br />
<br />

<strong>Username:</strong><br />
NZBMatrix username<br />
<input type="text" name="nzbmatrix_username" value="$sickbeard.NZBMATRIX_USERNAME" size="6"><br />
<br />

<strong>API Key:</strong><br />
NZBMatrix API Key<br />
<input type="text" name="nzbmatrix_apikey" value="$sickbeard.NZBMATRIX_APIKEY" size="35"><br />
<br />

</div>

<div class="providerDiv" id="nzbsrus">

<a href="http://www.nzbsrus.com" class="imgLink" target="_new"><img src="$sbRoot/images/providers/nzbsrus.gif" alt="NZBs'R'US" width="16" height="16"></a><br />
<br />

<strong>UID:</strong><br />
NZBs'R'US UID<br />
<input type="text" name="nzbsrus_uid" value="$sickbeard.NZBSRUS_UID" size="6"><br />
<br />

<strong>Hash:</strong><br />
NZBs'R'US hash<br />
<input type="text" name="nzbsrus_hash" value="$sickbeard.NZBSRUS_HASH" size="35"><br />
<br />

</div>

</fieldset>
</div>


<div class="EntryBlock">
<fieldset class="EntryFieldSet">

<legend>Manage Newznab Providers</legend>

<input type="hidden" name="newznab_providers" id="newznab_providers" value="<%='!!!'.join([x.configStr() for x in sickbeard.newznabProviderList])%>">
<select id="editANewznabProvider">
<option value="addNewznab">-- add new provider --
#for $curNewznabProvider in $sickbeard.newznabProviderList:
<option value="$curNewznabProvider.getID()">$curNewznabProvider.name
#end for
</select>
<br />
<br />

<div class="newznabProviderDiv" id="addNewznab">

<strong>Provider Name</strong><br />
<input type="text" id="addNewznab_name"><br />
<strong>Site URL</strong><br /><input type="text" id="addNewznab_url"><br />
<br />
<strong>Username</strong><br /><input type="text" id="addNewznab_username"><br />
<strong>Hash</strong><br /><input type="text" id="addNewznab_hash"><br />
(leave blank if not required)<br />
<input type="button" class="newznab_update" value="Add"><br />
</div>

#for $curNewznabProvider in $sickbeard.newznabProviderList:
#set $curID = $curNewznabProvider.getID()
<div class="newznabProviderDiv" id="$curID">

<strong>Provider Name</strong><br />
<input type="text" id="$(curID)_name" value="$curNewznabProvider.name" #if $curNewznabProvider.default then "disabled" else ""#><br />
<strong>Site URL</strong><br />
<input type="text" id="$(curID)_url" value="$curNewznabProvider.url" #if $curNewznabProvider.default then "disabled" else ""#><br />
<br />
<strong>UID</strong><br />
<input type="text" id="$(curID)_username" value="$curNewznabProvider.username"><br />
<strong>Hash</strong><br />
<input type="text" id="$(curID)_hash" value="$curNewznabProvider.hash"><br />
(leave blank if not required)<br />
<input type="button" class="newznab_update" value="Update">
<input type="button" class="newznab_delete" value="Delete" #if $curNewznabProvider.default then "disabled" else ""#><br />

</div>
#end for

</fieldset>
</div>




<p>
<input type="submit" value="Save Changes">
</p>
</form>


#include $os.path.join($sickbeard.PROG_DIR, "data/interfaces/default/inc_bottom.tmpl")
